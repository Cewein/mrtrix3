find_program(BASH bash)

set(DATA_DIR ${CMAKE_CURRENT_SOURCE_DIR}/data)

include(BashTests)
function(add_bash_script_test file_path)
    set(extra_labels "")
    foreach(label ${ARGN})
        list(APPEND extra_labels ${label})
    endforeach()
    
    set(EXEC_DIRS ${CMAKE_CURRENT_BINARY_DIR})
    list(APPEND EXEC_DIRS ${PROJECT_BINARY_DIR}/bin)
    list(APPEND EXEC_DIRS ${PROJECT_BINARY_DIR}/testing/tools)
    
    # Set folder name
    string(REPLACE "/" ";" folder_list ${file_path})
    list(GET folder_list 0 folder_name)

    add_bash_tests(
        FILE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/tests/${file_path}"
        PREFIX "${folder_name}"
        WORKING_DIRECTORY ${DATA_DIR}
        EXEC_DIRECTORIES "${EXEC_DIRS}"
        LABELS "script;${folder_name};${extra_labels}"
    )
endfunction()

add_bash_script_test(5ttgen/freesurfer_default)
add_bash_script_test(5ttgen/freesurfer_nocrop)
add_bash_script_test(5ttgen/freesurfer_sgmamyghipp)
add_bash_script_test(5ttgen/fsl_default)
add_bash_script_test(5ttgen/fsl_mask)
add_bash_script_test(5ttgen/fsl_nocrop)
add_bash_script_test(5ttgen/fsl_premasked)
add_bash_script_test(5ttgen/fsl_sgmamyghipp)
add_bash_script_test(5ttgen/hsvs_aseg)
add_bash_script_test(5ttgen/hsvs_default)
add_bash_script_test(5ttgen/hsvs_first)
add_bash_script_test(5ttgen/hsvs_modules)
add_bash_script_test(5ttgen/hsvs_template)
add_bash_script_test(5ttgen/hsvs_whitestem)

add_bash_script_test(dwi2mask/3dautomask_default)
add_bash_script_test(dwi2mask/3dautomask_options)
add_bash_script_test(dwi2mask/ants_config)
add_bash_script_test(dwi2mask/ants_template)
add_bash_script_test(dwi2mask/b02template_antsfull_clioptions)
add_bash_script_test(dwi2mask/b02template_antsfull_configfile)
add_bash_script_test(dwi2mask/b02template_antsfull_configoptions)
add_bash_script_test(dwi2mask/b02template_antsfull_template)
add_bash_script_test(dwi2mask/b02template_antsquick_config)
add_bash_script_test(dwi2mask/b02template_antsquick_template)
add_bash_script_test(dwi2mask/b02template_fsl_default)
add_bash_script_test(dwi2mask/b02template_fsl_flirtconfig)
add_bash_script_test(dwi2mask/b02template_fsl_fnirtcnf)
add_bash_script_test(dwi2mask/b02template_fsl_fnirtconfig)
add_bash_script_test(dwi2mask/consensus)
add_bash_script_test(dwi2mask/fslbet_default)
add_bash_script_test(dwi2mask/fslbet_options)
add_bash_script_test(dwi2mask/fslbet_rescale)
add_bash_script_test(dwi2mask/hdbet)
add_bash_script_test(dwi2mask/legacy)
add_bash_script_test(dwi2mask/mean)
add_bash_script_test(dwi2mask/mtnorm_default)
add_bash_script_test(dwi2mask/mtnorm_initmask)
add_bash_script_test(dwi2mask/mtnorm_lmax)
add_bash_script_test(dwi2mask/synthstrip_default)
add_bash_script_test(dwi2mask/synthstrip_options)
add_bash_script_test(dwi2mask/trace_default)
add_bash_script_test(dwi2mask/trace_iterative)

# TODO dwi2response

add_bash_script_test(dwibiascorrect/ants_default)
add_bash_script_test(dwibiascorrect/ants_mask)
add_bash_script_test(dwibiascorrect/fsl_default)
add_bash_script_test(dwibiascorrect/fsl_masked)
add_bash_script_test(dwibiascorrect/mtnorm_default)
add_bash_script_test(dwibiascorrect/mtnorm_lmax)
add_bash_script_test(dwibiascorrect/mtnorm_masked)

add_bash_script_test(dwibiasnormmask/default)
add_bash_script_test(dwibiasnormmask/lmax)
add_bash_script_test(dwibiasnormmask/maxiters)
add_bash_script_test(dwibiasnormmask/reference)
add_bash_script_test(dwibiasnormmask/scaled)

add_bash_script_test(dwicat/3dimage)
add_bash_script_test(dwicat/default_ownbzero)
add_bash_script_test(dwicat/default_sharedbzero)
add_bash_script_test(dwicat/nointensity)
add_bash_script_test(dwicat/rigidbody)

add_bash_script_test(dwifslpreproc/axis_padding)
add_bash_script_test(dwifslpreproc/eddyqc)
add_bash_script_test(dwifslpreproc/permuted_volumes)
add_bash_script_test(dwifslpreproc/rpeall)
add_bash_script_test(dwifslpreproc/rpeheader_none)
add_bash_script_test(dwifslpreproc/rpeheader_onerevbzero)
add_bash_script_test(dwifslpreproc/rpeheader_rpepair)
add_bash_script_test(dwifslpreproc/rpenone_default)
add_bash_script_test(dwifslpreproc/rpepair_alignseepi)
add_bash_script_test(dwifslpreproc/rpepair_default)

add_bash_script_test(dwigradcheck/default)

add_bash_script_test(dwinormalise/group)
add_bash_script_test(dwinormalise/manual_default)
add_bash_script_test(dwinormalise/manual_percentile)
add_bash_script_test(dwinormalise/mtnorm_default)
add_bash_script_test(dwinormalise/mtnorm_lmax)
add_bash_script_test(dwinormalise/mtnorm_masked)
add_bash_script_test(dwinormalise/mtnorm_scaled)
add_bash_script_test(dwinormalise/reference)

add_bash_script_test(dwishellmath/default)
add_bash_script_test(dwishellmath/oneshell)

add_bash_script_test(for_each/echo)
add_bash_script_test(for_each/exclude)
add_bash_script_test(for_each/parallel)

add_bash_script_test(labelsgmfirst/default)
add_bash_script_test(labelsgmfirst/freesurfer)
add_bash_script_test(labelsgmfirst/premasked)
add_bash_script_test(labelsgmfirst/sgm_amyg_hipp)

add_bash_script_test(population_template/fa_affine)
add_bash_script_test(population_template/fa_affinenonlinear)
add_bash_script_test(population_template/fa_default)
add_bash_script_test(population_template/fa_initaligngeometric)
add_bash_script_test(population_template/fa_initalignnone)
add_bash_script_test(population_template/fa_masked)
add_bash_script_test(population_template/fa_nonlinear)
add_bash_script_test(population_template/fa_rigid)
add_bash_script_test(population_template/fa_rigidaffine)
add_bash_script_test(population_template/fa_rigidnonlinear)
add_bash_script_test(population_template/fa_voxelsize)
add_bash_script_test(population_template/fod_default)
add_bash_script_test(population_template/fod_options)

add_bash_script_test(responsemean/default)
add_bash_script_test(responsemean/legacy)
