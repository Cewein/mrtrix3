find_program(BASH bash)

set(DATA_DIR ${CMAKE_CURRENT_SOURCE_DIR}/data)


include(BashTests)
function(add_bash_binary_tests file_path)
    set(extra_labels "")

    foreach(label ${ARGN})
	list(APPEND extra_labels ${label})
    endforeach()

    set(EXEC_DIRS ${CMAKE_CURRENT_BINARY_DIR})
    list(APPEND EXEC_DIRS ${PROJECT_BINARY_DIR}/bin)
    list(APPEND EXEC_DIRS ${PROJECT_BINARY_DIR}/testing/tools)

    # Set folder name
    string(REPLACE "/" ";" folder_list ${file_path})
    list(GET folder_list 0 folder_name)

    add_bash_tests(
	FILE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/tests/${file_path}"
	PREFIX "bin_${folder_name}"
	WORKING_DIRECTORY ${DATA_DIR}
	EXEC_DIRECTORIES "${EXEC_DIRS}"
	LABELS "binary;${extra_labels}"
    )
endfunction()

add_bash_binary_tests(5tt2gmwmi/default "CUSTOM")

add_bash_binary_tests(5tt2vis/default)

add_bash_binary_tests(5ttedit/default)

add_bash_binary_tests(amp2sh/default)

add_bash_binary_tests(connectomeedit/lower_triangular_from_asymmetric)
add_bash_binary_tests(connectomeedit/lower_triangular_from_lower_triangular)
add_bash_binary_tests(connectomeedit/lower_triangular_from_symmetric)
add_bash_binary_tests(connectomeedit/lower_triangular_from_upper_triangular)
add_bash_binary_tests(connectomeedit/symmetric_from_asymmetric)
add_bash_binary_tests(connectomeedit/symmetric_from_lower_triangular)
add_bash_binary_tests(connectomeedit/symmetric_from_symmetric)
add_bash_binary_tests(connectomeedit/symmetric_from_upper_triangular)
add_bash_binary_tests(connectomeedit/transpose)
add_bash_binary_tests(connectomeedit/upper_triangular_from_asymmetric)
add_bash_binary_tests(connectomeedit/upper_triangular_from_lower_triangular)
add_bash_binary_tests(connectomeedit/upper_triangular_from_symmetric)
add_bash_binary_tests(connectomeedit/upper_triangular_from_upper_triangular)
add_bash_binary_tests(connectomeedit/zero_diagonal)

add_bash_binary_tests(dirgen/cartesian)
add_bash_binary_tests(dirgen/default)
add_bash_binary_tests(dirgen/power)
add_bash_binary_tests(dirgen/unipolar)

add_bash_binary_tests(dwi2adc/default)

add_bash_binary_tests(dwi2fod/csd_default)
add_bash_binary_tests(dwi2fod/csd_lmax)
add_bash_binary_tests(dwi2fod/csd_masked)
add_bash_binary_tests(dwi2fod/msmt_default)
add_bash_binary_tests(dwi2fod/msmt_masked)

add_bash_binary_tests(dwi2tensor/bzero)
add_bash_binary_tests(dwi2tensor/default)
add_bash_binary_tests(dwi2tensor/dkt_constrained)
add_bash_binary_tests(dwi2tensor/dkt_unconstrained)
add_bash_binary_tests(dwi2tensor/iters)
add_bash_binary_tests(dwi2tensor/masked)
add_bash_binary_tests(dwi2tensor/ols)

add_bash_binary_tests(dwidenoise/default)
add_bash_binary_tests(dwidenoise/exp1_estimator)
add_bash_binary_tests(dwidenoise/extent_anisotropic)
add_bash_binary_tests(dwidenoise/extent_isotropic)
add_bash_binary_tests(dwidenoise/masked)
add_bash_binary_tests(dwidenoise/noise_default)
add_bash_binary_tests(dwidenoise/noise_extent)

add_bash_binary_tests(dwiextract/bzero)
add_bash_binary_tests(dwiextract/default)

add_bash_binary_tests(fixel2peaks/input_afd)
add_bash_binary_tests(fixel2peaks/input_directions)
add_bash_binary_tests(fixel2peaks/input_directory)
add_bash_binary_tests(fixel2peaks/input_index)

add_bash_binary_tests(fixel2sh/default)
add_bash_binary_tests(fixel2sh/lmax)

add_bash_binary_tests(fixel2tsf/default)

add_bash_binary_tests(fixel2voxel/absmax)
add_bash_binary_tests(fixel2voxel/complexity)
add_bash_binary_tests(fixel2voxel/count)
add_bash_binary_tests(fixel2voxel/dec_scaled)
add_bash_binary_tests(fixel2voxel/dec_unit)
add_bash_binary_tests(fixel2voxel/magmax)
add_bash_binary_tests(fixel2voxel/max)
add_bash_binary_tests(fixel2voxel/mean)
add_bash_binary_tests(fixel2voxel/min)
add_bash_binary_tests(fixel2voxel/none)
add_bash_binary_tests(fixel2voxel/product)
add_bash_binary_tests(fixel2voxel/sf)
add_bash_binary_tests(fixel2voxel/sum)

add_bash_binary_tests(fixelcfestats/default)
add_bash_binary_tests(fixelcfestats/legacy)
add_bash_binary_tests(fixelcfestats/masked)

add_bash_binary_tests(fixelconnectivity/masked)
add_bash_binary_tests(fixelconnectivity/weighted)

add_bash_binary_tests(fixelconvert/new_to_old)
add_bash_binary_tests(fixelconvert/old_to_new)

add_bash_binary_tests(fixelcorrespondence/default)

add_bash_binary_tests(fixelcrop/default)

add_bash_binary_tests(fixelfilter/smooth_inputdir)
add_bash_binary_tests(fixelfilter/smooth_inputfile)

add_bash_binary_tests(fixelreorient/default)

add_bash_binary_tests(fod2dec/anat_combo)
add_bash_binary_tests(fod2dec/anat_default)
add_bash_binary_tests(fod2dec/anat_lum)
add_bash_binary_tests(fod2dec/anat_masked)
add_bash_binary_tests(fod2dec/anat_noweight)
add_bash_binary_tests(fod2dec/anat_threshold)
add_bash_binary_tests(fod2dec/combo)
add_bash_binary_tests(fod2dec/default)
add_bash_binary_tests(fod2dec/lum)
add_bash_binary_tests(fod2dec/masked)
add_bash_binary_tests(fod2dec/noweight)
add_bash_binary_tests(fod2dec/threshold)

add_bash_binary_tests(fod2fixel/default)
add_bash_binary_tests(fod2fixel/masked)
add_bash_binary_tests(fod2fixel/nothresholds)

add_bash_binary_tests(label2colour/freesurfer)
add_bash_binary_tests(label2colour/iit)
add_bash_binary_tests(label2colour/random)

add_bash_binary_tests(label2mesh/blocky)
add_bash_binary_tests(label2mesh/default)

add_bash_binary_tests(labelconvert/aal)
add_bash_binary_tests(labelconvert/freesurfer)
add_bash_binary_tests(labelconvert/iit)
add_bash_binary_tests(labelconvert/lpba40)
add_bash_binary_tests(labelconvert/mismatch)

add_bash_binary_tests(maskfilter/connect_26connectivity)
add_bash_binary_tests(maskfilter/connect_26connectivity_largest)
add_bash_binary_tests(maskfilter/connect_axes)
add_bash_binary_tests(maskfilter/connect_axes_26connectivity)
add_bash_binary_tests(maskfilter/connect_default)
add_bash_binary_tests(maskfilter/connect_largest)
add_bash_binary_tests(maskfilter/dilate)
add_bash_binary_tests(maskfilter/erode)
add_bash_binary_tests(maskfilter/median)

add_bash_binary_tests(mesh2voxel/default)

add_bash_binary_tests(meshconvert/big_endian)
add_bash_binary_tests(meshconvert/little_endian)
add_bash_binary_tests(meshconvert/obj_ascii)
add_bash_binary_tests(meshconvert/obj_binary)
add_bash_binary_tests(meshconvert/stl_ascii)
add_bash_binary_tests(meshconvert/stl_binary)
add_bash_binary_tests(meshconvert/transform_first2real)
add_bash_binary_tests(meshconvert/transform_real2first)
add_bash_binary_tests(meshconvert/transform_real2voxel)
add_bash_binary_tests(meshconvert/transform_voxel2real)
add_bash_binary_tests(meshconvert/vtk_ascii)
add_bash_binary_tests(meshconvert/vtk_binary)

add_bash_binary_tests(mraverageheader/mean_nearest)
add_bash_binary_tests(mraverageheader/mean_projection)
add_bash_binary_tests(mraverageheader/min_nearest)
add_bash_binary_tests(mraverageheader/min_projection)
add_bash_binary_tests(mraverageheader/padding)

add_bash_binary_tests(mrcalc/expression_1)
add_bash_binary_tests(mrcalc/expression_2)
add_bash_binary_tests(mrcalc/expression_3)
add_bash_binary_tests(mrcalc/expression_4)

add_bash_binary_tests(mrcat/axis)
add_bash_binary_tests(mrcat/single_input)
add_bash_binary_tests(mrcat/singlevoxel)

add_bash_binary_tests(mrclusterstats/clustersize)
add_bash_binary_tests(mrclusterstats/default)
add_bash_binary_tests(mrclusterstats/legacy)
add_bash_binary_tests(mrclusterstats/masked)

add_bash_binary_tests(mrcolour/bothlimits)
add_bash_binary_tests(mrcolour/map_cool)
add_bash_binary_tests(mrcolour/map_gray)
add_bash_binary_tests(mrcolour/map_hot)
add_bash_binary_tests(mrcolour/map_inferno)
add_bash_binary_tests(mrcolour/map_jet)
add_bash_binary_tests(mrcolour/map_pet)
add_bash_binary_tests(mrcolour/map_rgb)
add_bash_binary_tests(mrcolour/map_viridis)
add_bash_binary_tests(mrcolour/scaling)
add_bash_binary_tests(mrcolour/upperlimit)

add_bash_binary_tests(mrconvert/big_endian)
add_bash_binary_tests(mrconvert/coord_end)
add_bash_binary_tests(mrconvert/format_mgh)
add_bash_binary_tests(mrconvert/format_mgz)
add_bash_binary_tests(mrconvert/format_mif_gz)
add_bash_binary_tests(mrconvert/format_mih)
add_bash_binary_tests(mrconvert/format_nii)
add_bash_binary_tests(mrconvert/format_nii_gz)
add_bash_binary_tests(mrconvert/format_png)
add_bash_binary_tests(mrconvert/insert_axis)
add_bash_binary_tests(mrconvert/multifile)
add_bash_binary_tests(mrconvert/multifile_singlevoxel)
add_bash_binary_tests(mrconvert/passthrough)
add_bash_binary_tests(mrconvert/real2complex)
add_bash_binary_tests(mrconvert/strides)

add_bash_binary_tests(mrdegibbs/default)

add_bash_binary_tests(mrfilter/gradient_default)
add_bash_binary_tests(mrfilter/gradient_magnitude)
add_bash_binary_tests(mrfilter/gradient_scanner)
add_bash_binary_tests(mrfilter/gradient_scanner_magnitude)
add_bash_binary_tests(mrfilter/median_default)
add_bash_binary_tests(mrfilter/median_extent_anisotropic)
add_bash_binary_tests(mrfilter/median_extent_isotropic)
add_bash_binary_tests(mrfilter/smooth_default)
add_bash_binary_tests(mrfilter/smooth_extent)
add_bash_binary_tests(mrfilter/smooth_fwhm)
add_bash_binary_tests(mrfilter/smooth_stdev_3vector)
add_bash_binary_tests(mrfilter/smooth_stdev_anisotropic)
add_bash_binary_tests(mrfilter/smooth_stdev_scalar)

add_bash_binary_tests(mrgrid/crop_axis_range)
add_bash_binary_tests(mrgrid/crop_axis_widths)
add_bash_binary_tests(mrgrid/crop_mask_default)
add_bash_binary_tests(mrgrid/crop_mask_nopadding)
add_bash_binary_tests(mrgrid/pad_singleaxis)
add_bash_binary_tests(mrgrid/pad_twoaxes)
add_bash_binary_tests(mrgrid/pad_uniform)
add_bash_binary_tests(mrgrid/pad_uniform_plus_singleaxis)
add_bash_binary_tests(mrgrid/regrid_anisotropic_scale)
add_bash_binary_tests(mrgrid/regrid_anisotropic_size)
add_bash_binary_tests(mrgrid/regrid_anisotropic_vox)
add_bash_binary_tests(mrgrid/regrid_downsample)
add_bash_binary_tests(mrgrid/regrid_upsample_default)
add_bash_binary_tests(mrgrid/regrid_upsample_linear)
add_bash_binary_tests(mrgrid/regrid_upsample_nearest)
add_bash_binary_tests(mrgrid/regrid_upsample_sinc)

add_bash_binary_tests(mrhistmatch/linear)
add_bash_binary_tests(mrhistmatch/scale)

add_bash_binary_tests(mrhistogram/allvolumes)
add_bash_binary_tests(mrhistogram/bins)
add_bash_binary_tests(mrhistogram/default)
add_bash_binary_tests(mrhistogram/masked)

add_bash_binary_tests(mrmath/multiimage_median)
add_bash_binary_tests(mrmath/singleimage_mean)
add_bash_binary_tests(mrmath/singleimage_norm)
add_bash_binary_tests(mrmath/singleimage_rms)

add_bash_binary_tests(mrregister/multicontrast_affine)
add_bash_binary_tests(mrregister/multicontrast_affine_weights)
add_bash_binary_tests(mrregister/multicontrast_rigidaffine_fod)
add_bash_binary_tests(mrregister/multicontrast_rigidnonlinear_fod)
add_bash_binary_tests(mrregister/singlecontrast_affine)
add_bash_binary_tests(mrregister/singlecontrast_rigidnonlinear_fod)

add_bash_binary_tests(mrstats/complex)
add_bash_binary_tests(mrstats/default)
add_bash_binary_tests(mrstats/masked)

add_bash_binary_tests(mrthreshold/3d_4dmask)
add_bash_binary_tests(mrthreshold/3d_abs)
add_bash_binary_tests(mrthreshold/3d_bottomcount)
add_bash_binary_tests(mrthreshold/3d_bottompercent)
add_bash_binary_tests(mrthreshold/3d_default_noimageout)
add_bash_binary_tests(mrthreshold/3d_default_withimageout)
add_bash_binary_tests(mrthreshold/3d_ignorezero)
add_bash_binary_tests(mrthreshold/3d_lessthan)
add_bash_binary_tests(mrthreshold/3d_masked)
add_bash_binary_tests(mrthreshold/3d_median)
add_bash_binary_tests(mrthreshold/3d_median_masked)
add_bash_binary_tests(mrthreshold/3d_outmasked)
add_bash_binary_tests(mrthreshold/3d_topcount)
add_bash_binary_tests(mrthreshold/3d_toppercent)
add_bash_binary_tests(mrthreshold/4d_default_noimageout)
add_bash_binary_tests(mrthreshold/4d_default_withimageout)
add_bash_binary_tests(mrthreshold/4d_masked)
add_bash_binary_tests(mrthreshold/4d_median)
add_bash_binary_tests(mrthreshold/4d_median_masked)
add_bash_binary_tests(mrthreshold/4d_verify_pervolume)
add_bash_binary_tests(mrthreshold/allvolumes_default)
add_bash_binary_tests(mrthreshold/allvolumes_masked)
add_bash_binary_tests(mrthreshold/allvolumes_median)
add_bash_binary_tests(mrthreshold/allvolumes_median_masked)

add_bash_binary_tests(mrtransform/fliplr)
add_bash_binary_tests(mrtransform/fod_linear_reorient_noresample)
add_bash_binary_tests(mrtransform/fod_linear_reorient_withresample)
add_bash_binary_tests(mrtransform/fod_nonlinear)
add_bash_binary_tests(mrtransform/identity)
add_bash_binary_tests(mrtransform/linear)
add_bash_binary_tests(mrtransform/linear_inverse)
add_bash_binary_tests(mrtransform/linear_template)
add_bash_binary_tests(mrtransform/noop)
add_bash_binary_tests(mrtransform/replace)

add_bash_binary_tests(mtnormalise/default)

add_bash_binary_tests(peaks2amp/default)

add_bash_binary_tests(peaks2fixel/default)

add_bash_binary_tests(sh2amp/default)
add_bash_binary_tests(sh2amp/grad)
add_bash_binary_tests(sh2amp/msmt)
add_bash_binary_tests(sh2amp/nonnegative)

add_bash_binary_tests(sh2peaks/default)
add_bash_binary_tests(sh2peaks/fast)

add_bash_binary_tests(sh2power/default)

add_bash_binary_tests(sh2response/default)

add_bash_binary_tests(shbasis/new2new)
add_bash_binary_tests(shbasis/new2old)
add_bash_binary_tests(shbasis/old2new)
add_bash_binary_tests(shbasis/old2old)

add_bash_binary_tests(shconv/default)
add_bash_binary_tests(shconv/msmt)

add_bash_binary_tests(tck2connectome/assignment_forward_search)
add_bash_binary_tests(tck2connectome/default)

add_bash_binary_tests(tckconvert/rib_write)
add_bash_binary_tests(tckconvert/scanner2voxel)
add_bash_binary_tests(tckconvert/text_read_range)
add_bash_binary_tests(tckconvert/text_write)
add_bash_binary_tests(tckconvert/vtk_read_binary)
add_bash_binary_tests(tckconvert/vtk_read_empty)
add_bash_binary_tests(tckconvert/vtk_write_ascii)
add_bash_binary_tests(tckconvert/vtk_write_binary)

add_bash_binary_tests(tckedit/include_exclude_inverse)
add_bash_binary_tests(tckedit/include_mask)
add_bash_binary_tests(tckedit/length)
add_bash_binary_tests(tckedit/mask)

add_bash_binary_tests(tckgen/act_terminations)
add_bash_binary_tests(tckgen/algorithm_ifod2)
add_bash_binary_tests(tckgen/algorithm_sdstream)
add_bash_binary_tests(tckgen/algorithm_tensordet)
add_bash_binary_tests(tckgen/algorithm_tensorprob)
add_bash_binary_tests(tckgen/backtrack)
add_bash_binary_tests(tckgen/multithreading)
add_bash_binary_tests(tckgen/seed_dynamic)
add_bash_binary_tests(tckgen/seed_gmwmi)
add_bash_binary_tests(tckgen/seed_grid_per_voxel)
add_bash_binary_tests(tckgen/seed_image)
add_bash_binary_tests(tckgen/seed_random_per_voxel)
add_bash_binary_tests(tckgen/seed_rejection)
add_bash_binary_tests(tckgen/seed_sphere)

add_bash_binary_tests(tckmap/dec)
add_bash_binary_tests(tckmap/default_template)
add_bash_binary_tests(tckmap/default_vox)
add_bash_binary_tests(tckmap/tod)

add_bash_binary_tests(tckresample/downsample)
add_bash_binary_tests(tckresample/endpoints)
add_bash_binary_tests(tckresample/num_points)
add_bash_binary_tests(tckresample/step_size)
add_bash_binary_tests(tckresample/upsample)

add_bash_binary_tests(tcksample/precise)
add_bash_binary_tests(tcksample/statmax)
add_bash_binary_tests(tcksample/statmean)
add_bash_binary_tests(tcksample/statmedian)
add_bash_binary_tests(tcksample/statmin)
add_bash_binary_tests(tcksample/statnone_text)
add_bash_binary_tests(tcksample/statnone_tsf)
add_bash_binary_tests(tcksample/tdifraction)

add_bash_binary_tests(tcksift/all)
add_bash_binary_tests(tcksift/default)

add_bash_binary_tests(tcksift2/all)
add_bash_binary_tests(tcksift2/default)

add_bash_binary_tests(tcktransform/unitwarp)

add_bash_binary_tests(tensor2metric/adc)
add_bash_binary_tests(tensor2metric/dkt)
add_bash_binary_tests(tensor2metric/eigenvalues)
add_bash_binary_tests(tensor2metric/eigenvectors)
add_bash_binary_tests(tensor2metric/fa)

add_bash_binary_tests(transformcalc/average)
add_bash_binary_tests(transformcalc/header)
add_bash_binary_tests(transformcalc/interpolate)

add_bash_binary_tests(transformcompose/affine_nonlinear)
add_bash_binary_tests(transformcompose/affine_to_image)
add_bash_binary_tests(transformcompose/two_affines)
add_bash_binary_tests(transformcompose/two_nonlinear)

add_bash_binary_tests(transformconvert/flirt_import)
add_bash_binary_tests(transformconvert/itk_ants)
add_bash_binary_tests(transformconvert/itk_ants_zero)
add_bash_binary_tests(transformconvert/itk_slicer)

add_bash_binary_tests(tsfdivide/default)

add_bash_binary_tests(tsfmult/default)

add_bash_binary_tests(tsfsmooth/default)

add_bash_binary_tests(tsfthreshold/default)
add_bash_binary_tests(tsfthreshold/invert)

add_bash_binary_tests(vectorstats/0)
add_bash_binary_tests(vectorstats/1)
add_bash_binary_tests(vectorstats/2)
add_bash_binary_tests(vectorstats/3)
add_bash_binary_tests(vectorstats/4)

add_bash_binary_tests(voxel2fixel/default)

add_bash_binary_tests(warp2metric/fc)
add_bash_binary_tests(warp2metric/jdet)
add_bash_binary_tests(warp2metric/jmat)

add_bash_binary_tests(warpcorrect/default)

add_bash_binary_tests(warpinit/default)
